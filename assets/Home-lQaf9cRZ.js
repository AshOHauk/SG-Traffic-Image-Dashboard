import{c as x,m as z,I as U,t as M,a as G,i as y,b as c,d as H,e as O,f as F,u as J,o as V,g as j,B as q,h as R,s as b}from"./index-JAZZ4BEm.js";const Y=[["polygon",{points:"3 6 9 3 15 6 21 3 21 18 15 21 9 18 3 21",key:"ok2ie8"}],["line",{x1:"9",x2:"9",y1:"3",y2:"18",key:"w34qz5"}],["line",{x1:"15",x2:"15",y1:"6",y2:"21",key:"volv9a"}]],Q=o=>x(U,z(o,{name:"Map",iconNode:Y})),X=Q,Z=c("<div>");function S({rounded:o,flat:p,children:w,padded:m,className:g}){const v="bg-white text-center h-min",i=M(o?"rounded-md":"",p?"":"shadow-md",m?"p-2":""),u=M(v,i,g);return(()=>{const h=Z();return G(h,u),y(h,w),h})()}const ee=c('<div class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50"><div class="relative top-20 mx-auto p-5 border w-10/12 shadow-lg rounded-md bg-white"><div class="flex justify-between items-center mb-3"><h3 class="text-lg leading-6 font-medium text-gray-900"></h3><button class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg p-2 ml-auto inline-flex items-center"><svg class="w-8 h-8"fill=currentColor viewBox="0 0 20 20"xmlns=http://www.w3.org/2000/svg><path fill-rule=evenodd d="M10 18a8 8 0 100-16 8 8 0 000 16zm2-9H8v2h4V9z"clip-rule=evenodd></path></svg></button></div><div class=mt-2>');function ae({isOpen:o,onClose:p,title:w,children:m}){return o?(()=>{const g=ee(),v=g.firstChild,i=v.firstChild,u=i.firstChild,h=u.nextSibling,$=i.nextSibling;return y(u,w),H(h,"click",p,!0),y($,m),g})():null}O(["click"]);const se={1001:"East Coast Parkway, Benjamin Sheares Bridge",1002:"Pan Island Expressway, Aljunied West Flyover",1003:"Pan Island Expressway, Kallang Way Flyover",1004:"Pan Island Expressway, Kallang Bahru Flyover",1005:"Kallang Paya Lebar Expressway, Defu Flyover",1006:"Kallang Paya Lebar Expressway, Defu Lane 3",1111:"Tampines Expressway, Pasir Ris Newtown",1112:"Tampines Expressway, Loyang Flyover",1113:"Tanah Merah Ferry Terminal",1501:"Marina Coastal Expressway, Straits Boulevard",1502:"Marina Coastal Expressway, Marina Link",1503:"Marina Coastal Expressway, Ayer Rajah",1504:"Marina Coastal Expressway, Tunnel East Coast ",1505:"Marina Coastal Expressway, Marina Link",1701:"Central Expressway, Moulmein Flyover",1702:"Central Expressway, Braddel Flyover",1703:"Central Expressway, Whampoa Flyover",1704:"Central Expressway, Chin Swee Road",1705:"Central Expressway, Ang Mo Kio North Flyover",1706:"Central Expressway, Yio Chu Kang Flyover",1707:"Central Expressway, Bukit Merah Flyover",1709:"Central Expressway, Thomson",1711:"Central Expressway, Ang Mo Kio South Flyover",2701:"Causeway",2702:"Woodlands Checkpoint",2703:"Bukit Timah Expressway, Chantek Flyover",2704:"Bukit Timah Expressway, Woodlands Flyover",2705:"Bukit Timah Expressway, Dairy Farm Flyover",2706:"Bukit Timah Expressway, Mandai Flyover",2707:"Bukit Timah Expressway, Gali Batu Flyover",2708:"Bukit Timah Expressway, Gali Batu Flyover",3702:"East Coast Parkway, Changi Flyover",3704:"East Coast Parkway, Tanjong Rhu",3705:"East Coast Parkway, Tanah Merah Flyover",3793:"East Coast Parkway, Laguna Flyover",3795:"East Coast Parkway, Marine Parade Flyover",3796:"East Coast Parkway, Tanjong Katong Flyover",3797:"East Coast Parkway, Tanjong Rhu Flyover",3798:"East Coast Parkway, Promenade",4701:"Ayer Rajah Expressway, Portsdown Flyover",4702:"Ayer Rajah Expressway, Keppel Flyover",4703:"Second Link",4704:"Ayer Rajah Expressway, Lower Delta Flyover",4705:"Ayer Rajah Expressway, Jurong Lake",4706:"Ayer Rajah Expressway, Jalan Ahmad Ibrahim",4708:"Ayer Rajah Expressway, Clementi",4710:"Ayer Rajah Expressway, Teban Flyover",4712:"Ayer Rajah Expressway, Jalan Ahmad Ibrahim",4713:"Ayer Rajah Expressway, Tuas Checkpoint",4714:"Ayer Rajah Expressway, Clementi Flyover",4716:"Ayer Rajah Expressway, Benoi Flyover",4798:"Sentosa Gateway",4799:"Sentosa Gateway",5794:"Pan Island Expressway, Bedok North Flyover",5795:"Pan Island Expressway, Eunos Flyover",5797:"Pan Island Expressway, Paya Lebar Flyover",5798:"Pan Island Expressway, Aljunied Flyover",5799:"Pan Island Expressway, Woodsville Flyover",6701:"Pan Island Expressway, Kim Keat Flyover",6703:"Pan Island Expressway, Thomson Flyover",6704:"Pan Island Expressway, Mount Pleasant Flyover",6705:"Pan Island Expressway, Woodsville Flyover",6706:"Pan Island Expressway, Chantek Flyover",6708:"Pan Island Expressway, Nanyang Flyover",6710:"Pan Island Expressway, Rifle Range Park",6711:"Pan Island Expressway, Changi Flyover",6712:"Pan Island Expressway, Clementi North Flyover",6713:"Pan Island Expressway, Tampines South Flyover",6714:"Pan Island Expressway, Tengah Flyover",6715:"Pan Island Expressway, Hongkah Flyover",6716:"Pan Island Expressway, Tuas Flyover",7791:"Tampines Expressway, Upper Changi Flyover",7793:"Tampines Expressway, Api Api Flyover",7794:"Tampines Expressway, Tampines Flyover",7795:"Tampines Expressway, Tampines Flyover",7796:"Tampines Expressway, Punggol Flyover",7797:"Tampines Expressway, Seletar Flyover",7798:"Tampines Expressway, Seletar Flyover",8701:"Kranji Expressway, Choa Chu Kang West Flyover",8702:"Kranji Expressway, Gali Batu",8704:"Kranji Expressway, Choa Chu Kang East Flyover",8706:"Kranji Expressway, Tengah Flyover",9701:"Seletar Expressway, Lentor Flyover",9702:"Seletar Expressway, Upper Thomson Flyover",9703:"Seletar Expressway, Woodlands South Flyover",9704:"Seletar Expressway, Ulu Sembawang Flyover",9705:"Seletar Expressway, Marsiling Flyover",9706:"Seletar Expressway, Sembawang Flyover"},re=c('<div class="flex flex-row items-start gap-5 px-10 relative"><div class="grid auto-rows-max grid-cols-2 row-auto sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4 overflow-auto h-fullwindow min-h-[500px] w-full"></div><div class="w-1/4 h-fullwindow relative hidden lg:block"><div class="absolute inset-0 overflow-auto space-y-4">'),te=c('<div class=relative><img class="h-32 w-full object-cover rounded-t-md"loading=lazy>'),ne=c('<div class="text-sm font-bold py-1 px-1">'),oe=c("<div class=text-xs>Camera "),le=c('<div class="text-center py-10 col-span-full max-w-full">'),ie=c("<div class=font-bold>"),de=c('<div class="text-sm font-bold">'),ye=c("<div class=text-sm>"),ce=c('<div class=flex><img class="w-1/2 object-cover"loading=lazy><iframe class="w-1/2 h-auto">');async function ue(o,p){var u;const w=`routeName:${o},${p}`,m=sessionStorage.getItem(w);if(m)return m;const v=await(await fetch(`https://sg-traffic-backend-ashohauk.onrender.com/api/onemap/route-name?lat=${o}&lng=${p}`)).json();console.log(v);let i=((u=v.GeocodeInfo[0])==null?void 0:u.ROAD)??"Unknown";return sessionStorage.setItem(w,i),i}function pe(o){return se[o]||"Unknown Camera ID"}function me(){const[o,p]=F([]),[w,m]=F(new Map),[g,v]=F([]),{search:i}=J();V(()=>{h(),A();const a=setInterval(h,60*1e3);return()=>clearInterval(a)});const u={Accident:"border-l-red-500 border-8",Roadwork:"border-l-yellow-400 border-8","Vehicle breakdown":"border-l-yellow-500 border-8",Weather:"border-l-blue-300 border-8",Obstacle:"border-l-orange-600 border-8","Road Block":"border-l-red-700 border-8","Heavy Traffic":"border-l-orange-500 border-8","Misc.":"border-l-gray-500 border-8",Diversion:"border-l-green-500 border-8","Unattended Vehicle":"border-l-purple-500 border-8"};async function h(){try{const a=await fetch("https://sg-traffic-backend-ashohauk.onrender.com/api/traffic/images");if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);const d=(await a.json()).value,s=await $(d);s.sort((t,e)=>t.CameraID.localeCompare(e.CameraID)),p(s)}catch(a){console.error("Fetching data failed:",a)}}const $=async a=>{const n=new Map(w()),d=await Promise.all(a.map(async s=>{n.get(s.CameraID)!==s.ImageLink&&(await N(s.ImageLink),n.set(s.CameraID,s.ImageLink));const t=pe(s.CameraID);return{...s,routeName:t}}));return m(n),d},N=a=>new Promise((n,d)=>{const s=new Image;s.src=a,s.onload=()=>n(),s.onerror=t=>d(t)});async function A(){try{const n=await fetch("https://sg-traffic-backend-ashohauk.onrender.com/api/traffic/incidents");if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);const s=(await n.json()).value,t=await B(s);v(t)}catch(a){console.error("Fetching data failed:",a)}}const B=async a=>await Promise.all(a.map(async d=>{const s=d.Longitude,t=d.Latitude,e=await ue(t,s);return{...d,routeName:e}})),[k,P]=F(!1),[f,D]=F(null),K=a=>{D(a),P(!0),console.log("button click",a,k())},W=()=>{P(!1)};return(()=>{const a=re(),n=a.firstChild,d=n.nextSibling,s=d.firstChild;return y(n,(()=>{const t=j(()=>o().filter(e=>{var r;return((r=e.routeName)==null?void 0:r.toLowerCase().includes(i().toLowerCase()))||e.CameraID.toLowerCase().includes(i().toLowerCase())}).length>0);return()=>t()?o().filter(e=>{var r;return((r=e.routeName)==null?void 0:r.toLowerCase().includes(i().toLowerCase()))||e.CameraID.toLowerCase().includes(i().toLowerCase())}).map(e=>x(S,{rounded:!0,flat:!1,padded:!1,get id(){return`camera-${e.CameraID}`},get children(){return[(()=>{const r=te(),I=r.firstChild;return y(r,x(q,{variant:"translucent",size:"icon",class:"absolute bottom-0 right-0",onClick:()=>K(e),get children(){return x(X,{})}}),null),R(l=>{const E=e.ImageLink,C=`Traffic Camera ${e.CameraID}`;return E!==l._v$&&b(I,"src",l._v$=E),C!==l._v$2&&b(I,"alt",l._v$2=C),l},{_v$:void 0,_v$2:void 0}),r})(),(()=>{const r=ne();return y(r,()=>e.routeName),r})(),(()=>{const r=oe();return r.firstChild,y(r,()=>e.CameraID,null),r})()]}})):le()})()),y(s,()=>g().map(t=>x(S,{rounded:!0,flat:!1,padded:!0,get id(){return`incident-${t.Message}`},get className(){return`${u[t.Type]}`},get children(){return[(()=>{const e=ie();return y(e,()=>t.Type),e})(),(()=>{const e=de();return y(e,()=>t.routeName),e})(),(()=>{const e=ye();return y(e,()=>t.Message),e})()]}}))),y(a,(()=>{const t=j(()=>!!k());return()=>t()&&x(ae,{get isOpen(){return k()},onClose:W,get title(){var e;return((e=f())==null?void 0:e.routeName)??"Unknown"},get children(){const e=ce(),r=e.firstChild,I=r.nextSibling;return R(l=>{var T,L;const E=f().ImageLink,C=`Traffic Camera ${f().CameraID}`,_=`https://www.onemap.gov.sg/minimap/minimap.html?mapStyle=Original&zoomLevel=15&latLng=${(T=f())==null?void 0:T.Latitude},${(L=f())==null?void 0:L.Longitude}`;return E!==l._v$3&&b(r,"src",l._v$3=E),C!==l._v$4&&b(r,"alt",l._v$4=C),_!==l._v$5&&b(I,"src",l._v$5=_),l},{_v$3:void 0,_v$4:void 0,_v$5:void 0}),e}})})(),null),a})()}export{me as default};
